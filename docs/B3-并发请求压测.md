# B3-并发请求压测报告

## 测试环境

| 项目 | 配置 |
|------|------|
| CPU | Apple M4 |
| CPU核心数 | 10 |
| 内存 | 24 GB |
| 操作系统 | macOS 15.7.3 |
| 编译器 | Apple clang 17.0.0 |
| 测试日期 | 2026-01-29 |

## 测试概述

本测试对比Stdio和HTTP两种传输协议在不同并发级别下的性能表现。

## 测试结果汇总

### Stdio传输协议

| 请求规模 | 平均耗时 | QPS | 平均延迟 |
|----------|----------|-----|----------|
| 100请求 | 0.0276s | 3,622 | 0.276ms |
| 1000请求 | 0.0434s | 23,049 | 0.043ms |
| 5000请求 | 0.1049s | 47,687 | 0.021ms |

**工具调用性能**：
- add工具 1000次调用：QPS 16,079

### HTTP传输协议

| 并发数 | 请求数 | 总耗时 | QPS | 平均延迟 |
|--------|--------|--------|-----|----------|
| 1 | 100 | 2.604s | 38.40 | 26.04ms |
| 10 | 500 | 1.296s | 385.80 | 2.59ms |
| 50 | 1000 | 1.508s | 663.00 | 1.51ms |

## 性能对比

### QPS对比

```
Stdio (5000请求):  ████████████████████████████████████████████████ 47,687
HTTP (50并发):     █ 663
```

### 延迟对比

```
Stdio最低延迟:  0.021ms  █
HTTP最低延迟:   1.51ms   ████████████████████████████████████████████████████████████████████████
```

## 分析结论

### Stdio优势

1. **极高吞吐量**：峰值QPS达47,687
2. **超低延迟**：最低0.021ms
3. **零网络开销**：直接进程间通信
4. **适用场景**：本地AI代理、CLI工具、IDE插件

### HTTP优势

1. **网络透明**：支持跨机器通信
2. **标准协议**：易于集成和调试
3. **并发友好**：异步IO模型
4. **适用场景**：微服务、Web应用、分布式系统

## 选型建议

| 场景 | 推荐协议 | 原因 |
|------|----------|------|
| 本地AI代理 | Stdio | 最高性能 |
| CLI工具 | Stdio | 简单直接 |
| Web服务 | HTTP | 网络访问 |
| 微服务 | HTTP | 分布式部署 |
| IDE插件 | Stdio | 低延迟响应 |
| 跨机器调用 | HTTP | 网络透明 |

## 性能优化路线图

### 短期优化

1. HTTP连接池实现
2. Keep-Alive支持
3. 批量请求支持

### 中期优化

1. HTTP/2多路复用
2. 内存池管理
3. JSON零拷贝解析

### 长期优化

1. WebSocket支持
2. gRPC协议支持
3. 自定义二进制协议
