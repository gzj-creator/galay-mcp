# B2-HTTP性能测试报告

## 测试环境

| 项目 | 配置 |
|------|------|
| CPU | Apple M4 |
| CPU核心数 | 10 |
| 内存 | 24 GB |
| 操作系统 | macOS 15.7.3 |
| 编译器 | Apple clang 17.0.0 |
| IO调度器数 | 20 |
| 计算调度器数 | 10 |
| 测试工具 | wrk |
| 测试日期 | 2026-01-30 |

## 测试方法

使用wrk向HTTP MCP服务器发送JSON-RPC请求，测量不同并发级别下的性能表现。

### 测试场景

1. **50连接测试**：模拟中等并发场景
2. **100连接测试**：模拟高并发场景
3. **工具调用测试**：测试业务处理性能

## 测试结果

### Ping请求性能

| 测试场景 | 线程数 | 连接数 | 测试时长 | QPS | 平均延迟 |
|----------|--------|--------|----------|-----|----------|
| 50连接 | 4 | 50 | 10s | 3,213 | 15.58ms |
| 100连接 | 4 | 100 | 10s | **6,270** | 15.24ms |

### 工具调用性能

| 测试场景 | 线程数 | 连接数 | 测试时长 | QPS | 平均延迟 |
|----------|--------|--------|----------|-----|----------|
| tools/call (add) | 4 | 50 | 10s | 3,188 | 14.69ms |

### 性能特点

1. **高吞吐量**：100连接下QPS达到6,270
2. **线性扩展**：连接数翻倍，QPS接近翻倍
3. **稳定延迟**：不同并发下延迟保持在15ms左右
4. **工具调用**：与ping性能接近，JSON处理开销可忽略

## 性能分析

### 吞吐量特点

1. **异步IO优势**：基于协程的异步IO模型在高并发下表现优异
2. **连接复用**：wrk使用Keep-Alive复用连接，减少TCP握手开销
3. **JSON处理高效**：nlohmann/json库性能优秀

### 与Stdio对比

| 指标 | Stdio | HTTP | 说明 |
|------|-------|------|------|
| 峰值QPS | 47,687 | 6,270 | Stdio无网络开销 |
| 平均延迟 | 0.021ms | 15.24ms | HTTP有网络传输延迟 |
| 适用场景 | 本地进程 | 网络服务 | 各有优势 |

### 延迟分析

HTTP延迟主要来自：
1. **网络传输**：TCP数据包传输（即使是本地回环）
2. **协议解析**：HTTP请求/响应头解析
3. **JSON处理**：序列化和反序列化（占比很小）

## 测试工具说明

之前使用curl测试QPS只有几百，是因为：
- curl每次fork新进程
- 每次建立新TCP连接
- 进程启动开销远大于请求本身

wrk使用连接池和多线程，更能反映服务器真实性能。

## 结论

HTTP传输协议在本测试环境下表现：
- 峰值QPS：**6,270**
- 平均延迟：**15.24ms**
- 并发扩展性：**优秀**

适用于需要网络访问的分布式场景，特别是：
- 跨机器通信
- 微服务架构
- Web集成场景
